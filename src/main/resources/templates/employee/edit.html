<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" th:href="@{/css/editEmp.css}" />
    <title>Edit Employee Details</title>
    <style>
      .d-none {
        display: none;
      }
      .form__group {
        margin-bottom: 15px;
      }
      .btncontainer {
        margin-top: 20px;
      }
      .submit {
        padding: 10px 20px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .submit:hover {
        background-color: #45a049;
      }
      .form__field.error {
		  border-color: red;
		  background-color: #ffe6e6;
		}
      
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Edit Employee Details</h2>
      <form id="editEmployeeForm" th:action="@{/employees/edit/{id}(id=${employee.id})}" method="post" data-id="${employee.id}">
<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>

        <div class="form__group">
          <select id="editField" class="form__field" onchange="showEditField()">
            <option value="">Select a field to edit</option>
            <option value="fullName">Full Name</option>
            <option value="dateOfBirth">Date of Birth</option>
            <option value="age">Age</option>
            <option value="currentCity">Current City</option>
            <option value="currentAddress">Current Address</option>
            <option value="mobile">Mobile</option>
            <option value="email">Email</option>
            <option value="emergencyContactName">Emergency Contact Name</option>
            <option value="emergencyContactMobile">
              Emergency Contact Mobile
            </option>
            <option value="employmentCode">Employment Code</option>
            <option value="companyMail">Company Mail</option>
            <option value="officePhone">Office Phone</option>
            <option value="officeAddress">Office Address</option>
            <option value="reportingManager">Reporting Manager</option>
            <option value="hrName">HR Name</option>
            <option value="employmentHistory">Employment History</option>
            <option value="dateOfJoining">Date of Joining</option>
            <option value="panCard">PAN Card</option>
            <option value="aadhaarCard">Aadhaar Card</option>
            <option value="bankDetails">Bank Details</option>
            <option value="ctcBreakup">CTC Breakup</option>
          </select>
        </div>

        <!-- Input fields that will be shown based on selection -->
        <div id="fullNameField" class="form__group d-none">
          <input
            type="text"
            class="form__field"
            placeholder="Enter Full Name"
            spellcheck="false"
            th:value="${employee.fullName}"
            required
          />
        </div>
        
        <div id="dateOfBirthField" class="form__group d-none">
          <input type="date" name="dateOfBirth" class="form__field" value="1990-01-01" required>

        </div>
        
        <div id="ageField" class="form__group d-none">
          <input
            type="number"
            class="form__field"
            placeholder="Enter Age"
            th:value="${employee.age}"
            required
          />
        </div>
      
        <div id="currentCityField" class="form__group d-none">
          <input
            type="text"
            class="form__field"
            placeholder="Enter Current City"
            th:value="${employee.currentAddress.city}"
            required
          />
        </div>
        
        <div id="currentAddressField" class="form__group d-none">
          <input
            type="text"
            class="form__field"
            placeholder="Enter Current Address"
            th:value="${employee.currentAddress.addressLine1}"
            required
          />
        </div>
        
        <div id="mobileField" class="form__group d-none">
          <input
            type="tel"
            class="form__field"
            name="mobile"
            placeholder="Enter Mobile Number"
            th:value="${employee.mobile}"
            required
          />
        </div>
        
        <div id="emailField" class="form__group d-none">
          <input
            type="email"
            class="form__field"
            placeholder="Enter Personal Email"
            th:value="${employee.personalMail}"
            required
          />
        </div>
        
        <div id="emergencyContactNameField" class="form__group d-none">
          <input
            type="text"
            class="form__field"
            placeholder="Enter Emergency Contact Name"
            th:value="${employee.emergencyContactName}"
            required
          />
        </div>
        
        <div id="emergencyContactMobileField" class="form__group d-none">
          <input
            type="tel"
            class="form__field"
            name="emergencyContactMobile"
            placeholder="Enter Emergency Contact Mobile"
            th:value="${employee.emergencyContactMobile}"
            required
          />
        </div>
        
        <div id="employmentCodeField" class="form__group d-none">
          <input
            type="text"
            class="form__field"
            name="employmentCode"
            placeholder="Enter Employment Code (6 Digits)"
            th:value="${employee.employmentCode}"
            required
          />
        </div>
        
        <div id="companyMailField" class="form__group d-none">
          <input
            type="email"
            class="form__field"
            placeholder="Enter Company Mail"
            th:value="${employee.companyMail}"
            required
          />
        </div>
        
        <div id="officePhoneField" class="form__group d-none">
          <input
            type="tel"
            class="form__field"
            placeholder="Enter Office Phone"
            th:value="${employee.officePhone}"
            required
          />
        </div>
        
        <div id="officeAddressField" class="form__group d-none">
          <input
            type="text"
            class="form__field"
            placeholder="Enter Office Address Line 1"
            th:value="${employee.officeAddress.addressLine1}"
            required
          />
          <input
            type="text"
            class="form__field"
            placeholder="Enter Office Address Line 2"
            th:value="${employee.officeAddress.addressLine2}"
          />
          <input
            type="number"
            class="form__field"
            name="officePinCode"
            placeholder="Enter Office Pin Code (6 Digits)"
            th:value="${employee.officeAddress.pinCode}"
            required
          />
        </div>
        
        <div id="reportingManagerField" class="form__group d-none">
          <input
            type="text"
            class="form__field"
            placeholder="Enter Reporting Manager Name"
            th:value="${employee.reportingManager}"
            required
          />
        </div>
        
        <div id="hrNameField" class="form__group d-none">
          <input
            type="text"
            class="form__field"
            placeholder="Enter HR Name"
            th:value="${employee.hrName}"
            required
          />
        </div>
        
        <div id="employmentHistoryField" class="form__group d-none">
          <textarea
            class="form__field"
            name="employmentHistory"
            placeholder="Enter Employment History"
            required
          >[EmploymentHistory(companyName=null, joiningDate=null, endDate=2020-12-31)]</textarea>
        </div>
        
        <div id="dateOfJoiningField" class="form__group d-none">
          <input type="date" class="form__field" th:value="${employee.dateOfJoining}" required />
        </div>

        <!-- Finance Section -->
        <div id="panCardField" class="form__group d-none">
          <input
            type="text"
            class="form__field"
            placeholder="Enter PAN Card Number"
            th:value="${employee.panCard}"
            required
          />
        </div>
        
        <div id="aadhaarCardField" class="form__group d-none">
          <input
            type="text"
            class="form__field"
            placeholder="Enter Aadhaar Card Number"
            th:value="${employee.aadharCard}"
            required
          />
        </div>
        
        <div id="bankDetailsField" class="form__group d-none">
          <textarea
            class="form__field"
            name="bankDetails"
            placeholder="Enter Bank Details"
            required
          >BankDetails(bankName=Bank XYZ, branch=null, ifscCode=BANK001)</textarea>
        </div>
        
        <div id="ctcBreakupField" class="form__group d-none">
          <textarea
            class="form__field"
            name="ctcBreakup"
            placeholder="Enter CTC Breakup"
            required
          >1200000.0</textarea>
        </div>

        <div class="btncontainer">
          <button class="submit">
            <div class="blob1"></div>
            <div class="blob2"></div>
            <div class="inner">E D I T</div>
          </button>
        </div>
      </form>
    </div>

    <script>
      function showEditField() {
        // Hide all fields initially
        const allFields = [
          "fullNameField",
          "dateOfBirthField",
          "ageField",
          "currentCityField",
          "currentAddressField",
          "mobileField",
          "emailField",
          "emergencyContactNameField",
          "emergencyContactMobileField",
          "employmentCodeField",
          "companyMailField",
          "officePhoneField",
          "officeAddressField",
          "reportingManagerField",
          "hrNameField",
          "employmentHistoryField",
          "dateOfJoiningField",
          "panCardField",
          "aadhaarCardField",
          "bankDetailsField",
          "ctcBreakupField",
        ];

        allFields.forEach((field) => {
          document.getElementById(field).classList.add("d-none");
        });

        // Show the selected field
        const selectedField = document.getElementById("editField").value;
        if (selectedField) {
          document
            .getElementById(`${selectedField}Field`)
            .classList.remove("d-none");
        }
      }
     // document.getElementById(`${selectedField}Field`).classList.remove("d-none");

      const container = document.querySelector(".container");

      // On mouse enter (hover), change background and font color
      container.addEventListener("mouseenter", () => {
        document.body.style.backgroundColor = "#000"; // Dark background on hover
        document.body.style.color = "#fff"; // White font on hover
      });

      // On mouse leave, revert back to initial styles
      container.addEventListener("mouseleave", () => {
        document.body.style.backgroundColor = "white"; // Revert to white background
        document.body.style.color = "black"; // Revert to black font
      });
      
      document.getElementById('editEmployeeForm').addEventListener('submit', function(event) {
    	    event.preventDefault(); // Prevent the default form submission

    	    // Get the dynamic ID from the form's data-id attribute
    	    const employeeId = this.getAttribute('data-id');

    	    // Gather form data
    	    const formData = new URLSearchParams(new FormData(this));

    	    // Make the fetch request using the dynamic ID
    	    fetch(`/employees/edit/${employeeId}`, {
    	        method: 'POST',
    	        headers: {
    	            'Content-Type': 'application/x-www-form-urlencoded',
    	        },
    	        body: formData,
    	    })
    	    .then(response => {
    	        if (!response.ok) {
    	            throw new Error('Network response was not ok ' + response.statusText);
    	        }
    	        return response.text(); // or response.json() if you expect JSON response
    	    })
    	    .then(data => {
    	        console.log('Success:', data); // Handle success, maybe redirect or show a message
    	        window.location.href = '/employees'; // Redirect after successful update
    	    })
    	    .catch((error) => {
    	        console.error('Error:', error); // Handle errors here
    	    });
    	});


    </script>
  </body>
</html>
